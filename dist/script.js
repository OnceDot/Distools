!function(){"use strict";function e(e){return new Promise(t=>setTimeout(t,e))}function t(e,s){return new Promise((n,r)=>{e(s).then(e=>n(e.body)).catch(a=>{429==a.status?setTimeout(()=>n(t(e,s)),1e3*a.body.retry_after):r(a)})})}const s={getByProps(...e){return this.getModule(t=>e.every(e=>t[e]))},getByValue(e,t){return this.getModule(s=>s[e]==t,!0)},getModule(e,t=!1){let s=this.getModules();for(let n in s){let{exports:r}=s[n];if(r){if(r.__esModule&&r.default&&e(r.default))return t?r:r.default;if(e(r))return r}}},getModules(){let e="webpackmodules";return this._require||(this._require="function"==typeof window.webpackJsonp?window.webpackJsonp([],{[e]:(e,t,s)=>t.default=s},[e]).default:window.webpackJsonp.push([[],{[e]:(e,t,s)=>e.exports=s},[[e]]]).c,delete this._require[e]),this._require}},n=s.getByProps("Inflate").Inflate,r=s.getByProps("getErlpackEncoding").getErlpackEncoding(),a=(s.getByProps("createElement","cloneElement"),s.getByProps("render","findDOMNode"),s.getByProps("getAPIBaseURL")),l=s.getByProps("Permissions","ActivityTypes","StatusTypes"),i=(s.getByProps("getToken"),s.getByProps("getCurrentUser")),o=(s.getByProps("receiveMessage","sendBotMessage"),s.getByProps("getMember")),d=s.getByProps("getChannel"),g=(s.getByProps("getChannels"),s.getByProps("getMessages")),u=s.getByProps("getLastSelectedGuildId"),c=s.getByProps("getLastSelectedChannelId"),h=s.getByProps("getUsers"),p=s.getByProps("getActivities").getState();const y={hijack:function(){return Promise.all([new Promise(e=>{const t=WebSocket.prototype.send;WebSocket.prototype.send=function(){return this.url.includes("gateway.discord.gg")&&(WebSocket.prototype.send=t,e(this)),t.apply(this,arguments)}}),new Promise(e=>{const t=n.prototype.push;n.prototype.push=function(){return n.prototype.push=t,e(this),t.apply(this,arguments)}})]).then(([e,t])=>{let s=r?new r:{pack:JSON.stringify,unpack:e=>e},n=t.onEnd;return{ws:e,setSpotifyStatus(e={}){this.send({op:3,d:{status:"dnd",since:0,activities:[{type:2,name:"Spotify",assets:{large_image:"spotify:"+e.image},details:e.title,state:e.authors,timestamps:{start:Date.now(),end:Date.now()+864e5},party:null,sync_id:null,flags:48,metadata:{album_id:null,artist_ids:[]}}],afk:!1}})},setVoiceState(e,t,s,n,r){this.send({op:4,d:{guild_id:e,channel_id:t,self_mute:s,self_deaf:n,self_video:r}})},send(t){e.send(s.pack(t))},receive(e){n=t.onEnd,t.onEnd=function(){return this.chunks.map(t=>{e(s.unpack(t))}),n.apply(this,arguments)}},stop(){t.onEnd=n}}})},fetchRelationships:e=>t(a.get,l.Endpoints.USER_RELATIONSHIPS(e)),async searchSharedFriends(t){let s=Object.values(y.users),n=[];for(let t of s)t.relationships?n.push(Promise.resolve(t)):(n.push(y.fetchRelationships(t.id).then(e=>(t.relationships=e,t))),await e(25));return Promise.all(n).then(e=>e.filter(({relationships:e})=>e.find(({id:e})=>e===t)))},getUserActivities(e){let t=p.clientStatuses[e];return t&&{id:e,activities:p.activities[e],status:t}},searchGuildMessages:(e=y.selectedGuildId,s=y.user.id,n=0)=>t(a.get,l.Endpoints.SEARCH_GUILD(e)+`?author_id=${s}&include_nsfw=true&offset=${n}`),searchChannelMessages:(e=y.selectedChannelId,s=y.user.id,n=0)=>t(a.get,l.Endpoints.SEARCH_CHANNEL(e)+`?author_id=${s}&offset=${n}`),async searchAllMessages(e,t,s,n=!0){let r,a=[],l=0;for(;(r=await e(t,s,l)).messages.length&&(a.push(...r.messages),l+=r.messages.length,!(a.length>=1500)););return n?a.map(e=>e.find(e=>e.hit)):a},searchAllGuildMessages:(e=y.selectedGuildId,t=y.user.id,s=!0)=>y.searchAllMessages(y.searchGuildMessages,e,t,s),searchAllChannelMessages:(e=y.selectedChannelId,t=y.user.id,s=!0)=>y.searchAllMessages(y.searchChannelMessages,e,t,s),deleteMessage:(e,s)=>t(a.delete,l.Endpoints.MESSAGES(e)+"/"+s),async deleteSearchMessages(t,s,n){let r=await y.searchAllMessages(t,s,n),a=0;y.progressBar.setSteps(r.length);for(let t of r)y.progressBar.setProgress(++a),console.log(`[DISTOOLS][🗑️] ${a} / ${r.length} messages.`),0!=t.type&&19!=t.type||(await y.deleteMessage(t.channel_id,t.id),await e(150));console.log("Done."),await e(2e3),y.progressBar.setProgress(0)},deleteGuildMessages:(e=y.selectedGuildId,t=y.user.id)=>y.deleteSearchMessages(y.searchGuildMessages,e,t),deleteChannelMessages:(e=y.selectedChannelId,t=y.user.id)=>y.deleteSearchMessages(y.searchChannelMessages,e,t),async fetchAllMessages(e=y.selectedChannelId){let t=[],s=[];do{s.push(...t),t=(await a.get({url:l.Endpoints.MESSAGES(e),query:{before:t[t.length-1].id,limit:100}})).body}while(t.length>0);return s.reverse()},saveMessages(e=y.selectedChannelId){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !"),y.fetchAllMessages(e).then(t=>{const s=new Map;t=t.map(e=>(s.set(e.author.id,e.author),(e={...e}).author=e.author.id,delete e.channel_id,e)),function(e,t){let s=window.URL.createObjectURL(new Blob([t],{type:"octet/stream"})),n=document.createElement("a");n.href=s,n.download=e,n.style.display="none",n.click(),window.URL.revokeObjectURL(s)}(e+".json",JSON.stringify({channel:e,users:[...s.values()],messages:t}))})},get members(){return y.selectedGuildId?o.getMembers(y.selectedGuildId):d.getChannel(y.selectedChannelId).rawRecipients},get users(){return h.getUsers()},get selectedGuildId(){return u.getGuildId()},get selectedChannelId(){return c.getChannelId()},get selectedChannel(){return d.getChannel(y.selectedChannelId)},get messages(){return g.getMessages(y.selectedChannelId).toArray()},get user(){return i.getCurrentUser()}};y.progressBar=new Proxy({},{get:()=>()=>{}}),window.DISTOOLS=y}();
