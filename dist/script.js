!function(){"use strict";function e(e){return new Promise(t=>setTimeout(t,e))}const t={getByProps(...e){return this.getModule(t=>e.every(e=>t[e]))},getByValue(e,t){return this.getModule(s=>s[e]==t,!0)},getModule(e,t=!1){let s=this.getModules();for(let n in s){let{exports:r}=s[n];if(r){if(r.__esModule&&r.default&&e(r.default))return t?r:r.default;if(e(r))return r}}},getModules(){let e="webpackmodules";return this._require||(this._require="function"==typeof window.webpackJsonp?window.webpackJsonp([],{[e]:(e,t,s)=>t.default=s},[e]).default:window.webpackJsonp.push([[],{[e]:(e,t,s)=>e.exports=s},[[e]]]).c,delete this._require[e]),this._require}},s=t.getByProps("createElement","cloneElement"),n=t.getByProps("render","findDOMNode"),r=t.getByProps("getAPIBaseURL"),a=t.getByProps("Permissions","ActivityTypes","StatusTypes"),o=t.getByProps("getCurrentUser"),i=t.getByProps("getToken"),l=t.getByProps("getMember"),d=t.getByProps("getChannels"),c=t.getByProps("getMessages"),g=t.getByProps("getLastSelectedGuildId"),h=t.getByProps("getLastSelectedChannelId"),u=t.getByProps("receiveMessage","sendBotMessage");var p={async searchSharedFriends(e){var t=this.members,s=[];for(var n of t){if(!n.relationships){var o=await r.get(a.Endpoints.USER_RELATIONSHIPS(n.userId));n.relationships=JSON.parse(o.text)}n.relationships.length&&s.push(n)}if(e){var i=[];for(var n of s)n.relationships.find(t=>t.id===e)&&i.push(n);s=i}return s},searchOwnGuildMessages(e,t=this.user.id,s=0){return new Promise((n,o)=>{r.get(`${a.Endpoints.SEARCH_GUILD(e)}?author_id=${t}&include_nsfw=true&offset=${s}`).then(e=>n(e.body)).catch(o)})},searchOwnChannelMessages(e,t=this.user.id,s=0){return new Promise((n,o)=>{r.get(`${a.Endpoints.SEARCH_CHANNEL(e)}?author_id=${t}&offset=${s}`).then(e=>n(e.body)).catch(o)})},async deleteOwnGuildMessages(){var t=this.selectedGuildId,s=await this.searchOwnGuildMessages(t),n=0;if(s)if(s.total_results>0){this.progressBar.setSteps(s.total_results);do{for(var r of(console.log(s.total_results+" remaining messages."),await e(200),s.messages)){for(var a of r)a.hit&&!a.call&&(await this.deleteMessage(a.channel_id,a.id),await e(200),n++);this.progressBar.setProgress(n)}}while((s=await this.searchOwnGuildMessages(t))&&s.total_results>0);console.log("Done."),await e(2e3),this.progressBar.setProgress(0)}else console.log("No message to delete.");else console.log("Index is not ready, try again.")},async deleteOwnChannelMessages(){var t=this.selectedChannelId,s=await this.searchOwnChannelMessages(t),n=0;if(s)if(s.total_results>0){this.progressBar.setSteps(s.total_results);do{for(var r of(console.log(s.total_results+" remaining messages."),await e(200),s.messages)){for(var a of r)a.hit&&!a.call&&(await this.deleteMessage(t,a.id),await e(200),n++);this.progressBar.setProgress(n)}}while((s=await this.searchOwnChannelMessages(t))&&s.messages.length>0);console.log("Done."),await e(2e3),this.progressBar.setProgress(0)}else console.log("No message to delete.");else console.log("Index is not ready, try again.")},async fetchAllMessages(e=this.selectedChannelId){var t=this.messages.reverse(),s=[];do{s.push(...t),t=(await r.get({url:a.Endpoints.MESSAGES(e),query:{before:t[t.length-1].id,limit:100}})).body}while(t.length>0);return s.reverse()},async saveMessages(){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !");var e,t,s=this.members,n=await this.fetchAllMessages(),r=[],a=[];for(t of n)a.push({id:t.id,author:t.author.id,content:t.content,timestamp:t.timestamp});for(e of(s.push(this.user),s))r.push({id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar});this.downloadTextFile(n[0].channel_id+".json",JSON.stringify({members:r,messages:a},null,2))},async anarchy(){var t,s,n=this.messages.reverse(),r=["üá®","üá¥","üá∫","üá∑","üá¶","üá¨","üá™"];for(t of n)for(s of r)await this.addReaction(t,s),await e(95)},addReaction:(e,t="üçÜ")=>new Promise((s,n)=>{r.put(a.Endpoints.REACTION(e.channel_id,e.id,t,"@me")).then(s).catch(n)}),downloadTextFile(e,t){var s=window.URL.createObjectURL(new Blob([t],{type:"octet/stream"})),n=document.createElement("a");n.href=s,n.download=e,n.style.display="none",document.body.prepend(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)},deleteMessage:(e,t)=>new Promise((s,n)=>{r.delete(`${a.Endpoints.MESSAGES(e)}/${t}`).then(e=>s(e.body)).catch(n)}),get receiveMessages(){return u},get members(){return this.selectedGuildId?l.getMembers(this.selectedGuildId):this.selectedChannel._getUsers()},get selectedGuildId(){return g.getGuildId()},get selectedChannelId(){return h.getChannelId()},get selectedChannel(){return d.getChannel(this.selectedChannelId)},get messages(){return c.getMessages(this.selectedChannelId).toArray()},get user(){return o.getCurrentUser()},get token(){return i.getToken()},_test(){var e=document.createElement("style");e.innerHTML=".video-8eMOth, .imageWrapper-2p5ogY > img { transition: filter ease-in-out .25s; filter: blur(0.6rem); }\n.video-8eMOth:hover, .imageWrapper-2p5ogY > img:hover { filter: unset; }",document.head.append(e)}};class m extends s.Component{constructor(e){super(e),this.node=s.createRef()}componentDidUpdate(){this.node.current&&window.requestAnimationFrame(()=>{var e=this.node.current.style;e.transform="translate(-50%, -50%) scale(1)",e.opacity="1"})}render(){return this.props.hide?null:s.createElement("div",{class:"modal",style:{opacity:0},ref:this.node},s.createElement("form",{class:"settings"},s.createElement("label",null,s.createElement("input",{type:"radio",value:"guild",checked:"true"}),"Current Guild"),s.createElement("label",null,s.createElement("input",{type:"radio",value:"channel"}),"Current Channel")))}}class f extends s.Component{constructor(e){super(e),this.progressBar=s.createRef(),this.steps=100}setSteps(e){this.steps=e}setProgress(e){this.progressBar.current.style.width=e/this.steps*100+"%"}render(){return s.createElement("div",{class:"progress-bar"},s.createElement("div",{class:"progress",ref:this.progressBar}))}}class w extends s.Component{constructor(e){super(e),this.state={hideSettings:!0},this.progressBar=s.createRef()}componentDidMount(){p.progressBar=this.progressBar.current}render(){return s.createElement(s.Fragment,null,s.createElement("style",null,"#distools * {\n    box-sizing: border-box;\n}\n\n#distools .right {\n    margin-left: auto;\n}\n\n#distools>nav {\n    background-color: #191818;\n    position: fixed;\n    left: 0;\n    bottom: 0;\n    display: flex;\n    height: 48px;\n    width: 100%;\n    padding: 0 4.5rem;\n    font-size: 0.85rem;\n    color: #fff;\n}\n\n#distools>nav>* {\n    display: flex;\n    align-items: center;\n}\n\n#distools>nav>.title {\n    margin-right: 1.5rem;\n    font-weight: bold;\n}\n\n#distools>nav>ul>li {\n    transition: background-color ease-in-out .2s;\n    display: flex;\n    align-items: center;\n    height: 100%;\n    padding: 0 1rem;\n    cursor: pointer;\n}\n\n#distools>nav>ul>li:hover {\n    background-color: #000;\n}\n\n/* PROGRESS BAR */\n.progress-bar {\n    background-color: #36393f;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    height: 2px;\n}\n\n.progress {\n    transition: width ease-in-out .8s;\n    background-color: #2e70f3;\n    width: 0;\n    height: 2px;\n}\n\n/* MODAL */\n.modal {\n    transition: ease-in-out .25s;\n    transition-property: transform, opacity;\n    transform: translate(-50%, -50%) scale(0.8);\n    opacity: 0;\n    background-color: #191818;\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    width: 500px;\n    height: 500px;\n    z-index: 1;\n    color: #fff;\n}"),s.createElement(m,{hide:this.state.hideSettings}),s.createElement("nav",null,s.createElement(f,{ref:this.progressBar}),s.createElement("div",{class:"title"},"DISTOOLS"),s.createElement("ul",null,s.createElement("li",{onClick:()=>p.deleteOwnGuildMessages()},"üóëÔ∏è Delete guild messages"),s.createElement("li",{onClick:()=>p.deleteOwnChannelMessages()},"üóëÔ∏è Delete channel messages"),s.createElement("li",{onClick:()=>p.saveMessages()},"üíæ Save messages")),s.createElement("ul",{class:"right"},s.createElement("li",{onClick:()=>this.setState({hideSettings:!this.state.hideSettings})},"‚öôÔ∏è Settings"))))}}document.getElementById("app-mount").style.height="calc(100vh - 48px)";var y=document.getElementById("distools");y&&y.remove(),(y=document.createElement("div")).id="distools",n.render(s.createElement(w,null),y),document.body.prepend(y),window.DISTOOLS=p}();
