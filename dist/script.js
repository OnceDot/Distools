!function(){"use strict";function e(e){return new Promise(s=>setTimeout(s,e))}const s={getByProps(...e){return this.getModule(s=>e.every(e=>s[e]))},getByValue(e,s){return this.getModule(t=>t[e]==s,!0)},getModule(e,s=!1){let t=this.getModules();for(let r in t){let{exports:n}=t[r];if(n){if(n.__esModule&&n.default&&e(n.default))return s?n:n.default;if(e(n))return n}}},getModules(){let e="webpackmodules";return this._require||(this._require="function"==typeof window.webpackJsonp?window.webpackJsonp([],{[e]:(e,s,t)=>s.default=t},[e]).default:window.webpackJsonp.push([[],{[e]:(e,s,t)=>e.exports=t},[[e]]]).c,delete this._require[e]),this._require}},t=(s.getByProps("createElement","cloneElement"),s.getByProps("render","findDOMNode"),s.getByProps("getAPIBaseURL")),r=s.getByProps("Permissions","ActivityTypes","StatusTypes"),n=s.getByProps("getCurrentUser"),l=(s.getByProps("getToken"),s.getByProps("getMember")),a=s.getByProps("getChannel"),d=(s.getByProps("getChannels"),s.getByProps("getMessages")),o=s.getByProps("getLastSelectedGuildId"),i=s.getByProps("getLastSelectedChannelId"),g=s.getByProps("getUsers"),h=(s.getByProps("receiveMessage","sendBotMessage"),{fetchRetry:(e,s)=>new Promise((t,r)=>{e(s).then(e=>t(e.body)).catch(n=>{429==n.statusCode?setTimeout(()=>t(h.fetchRetry(e,s)),1e3*n.body.retry_after):r(n)})}),fetchRelationships:e=>h.fetchRetry(t.get,r.Endpoints.USER_RELATIONSHIPS(e)),fetchAllMembers(){console.log(r.Endpoints)},async searchSharedFriends(s){let t=Object.values(h.users),r=[];for(let s of t)s.relationships?r.push(Promise.resolve(s)):(r.push(h.fetchRelationships(s.id).then(e=>(s.relationships=e,s))),await e(25));return Promise.all(r).then(e=>e.filter(({relationships:e})=>e.find(({id:e})=>e===s)))},searchGuildMessages:(e=h.selectedGuildId,s=h.user.id,n=0)=>h.fetchRetry(t.get,r.Endpoints.SEARCH_GUILD(e)+`?author_id=${s}&include_nsfw=true&offset=${n}`),searchChannelMessages:(e=h.selectedChannelId,s=h.user.id,n=0)=>h.fetchRetry(t.get,r.Endpoints.SEARCH_CHANNEL(e)+`?author_id=${s}&offset=${n}`),async searchAllMessages(e,s,t,r=!0){let n,l=[],a=0;for(;(n=await e(s,t,a)).messages.length&&(l.push(...n.messages),a+=n.messages.length,!(l.length>=1500)););return r?l.map(e=>e.find(e=>e.hit)):l},searchAllGuildMessages:(e=h.selectedGuildId,s=h.user.id,t=!0)=>h.searchAllMessages(h.searchGuildMessages,e,s,t),searchAllChannelMessages:(e=h.selectedChannelId,s=h.user.id,t=!0)=>h.searchAllMessages(h.searchChannelMessages,e,s,t),deleteMessage:(e,s)=>h.fetchRetry(t.delete,r.Endpoints.MESSAGES(e)+"/"+s),async deleteSearchMessages(s,t,r){let n=await h.searchAllMessages(s,t,r),l=0;h.progressBar.setSteps(n.length);for(let s of n)h.progressBar.setProgress(++l),console.log(`[DISTOOLS][🗑️] ${l} / ${n.length} messages.`),0!=s.type&&19!=s.type||(await h.deleteMessage(s.channel_id,s.id),await e(150));console.log("Done."),await e(2e3),h.progressBar.setProgress(0)},deleteGuildMessages:(e=h.selectedGuildId,s=h.user.id)=>h.deleteSearchMessages(h.searchGuildMessages,e,s),deleteChannelMessages:(e=h.selectedChannelId,s=h.user.id)=>h.deleteSearchMessages(h.searchChannelMessages,e,s),async fetchAllMessages(e=h.selectedChannelId){let s=h.messages.reverse(),n=[];do{n.push(...s),s=(await t.get({url:r.Endpoints.MESSAGES(e),query:{before:s[s.length-1].id,limit:100}})).body}while(s.length>0);return n.reverse()},saveMessages(e=h.selectedChannelId){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !"),h.fetchAllMessages(e).then(s=>{const t=new Map;s=s.map(e=>(t.set(e.author.id,e.author),(e={...e}).author=e.author.id,delete e.channel_id,e)),h.downloadTextFile(s[0].channel_id+".json",JSON.stringify({channel:e,users:[...t.values()],messages:s}))})},downloadTextFile(e,s){let t=window.URL.createObjectURL(new Blob([s],{type:"octet/stream"})),r=document.createElement("a");r.href=t,r.download=e,r.style.display="none",document.body.prepend(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)},get members(){return h.selectedGuildId?l.getMembers(h.selectedGuildId):a.getChannel(h.selectedChannelId).rawRecipients},get users(){return g.getUsers()},get selectedGuildId(){return o.getGuildId()},get selectedChannelId(){return i.getChannelId()},get selectedChannel(){return a.getChannel(h.selectedChannelId)},get messages(){return d.getMessages(h.selectedChannelId).toArray()},get user(){return n.getCurrentUser()}});h.progressBar=new Proxy({},{get:()=>()=>{}}),window.DISTOOLS=h}();
